<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Cybers√©curit√© - √âcole d'Ing√©nieurs</title>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
      padding: 30px;
      text-align: center;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 16px;
    }
    button {
      background: var(--secondary);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #2980b9;
    }
    .question-container {
      display: none;
    }
    .result-container {
      display: none;
    }
    .badge {
      font-size: 80px;
      margin: 20px 0;
    }
    .progress {
      height: 8px;
      background: #eee;
      border-radius: 4px;
      margin: 20px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div class="container" id="email-screen">
    <h1>üîê Quiz Cybers√©curit√©</h1>
    <p>Veuillez entrer votre email professionnel pour commencer :</p>
    <input type="email" id="user-email" placeholder="prenom.nom@ecole.fr" required />
    <button onclick="startQuiz()">Commencer le quiz</button>
  </div>

  <div class="container question-container" id="quiz-screen">
    <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
    <h2 id="question-text">Question ?</h2>
    <div id="answers"></div>
    <button id="next-btn" style="display:none;" onclick="nextQuestion()">Suivant</button>
  </div>

  <div class="container result-container" id="result-screen">
    <h1>Votre r√©sultat üéâ</h1>
    <div class="badge" id="badge">üèÖ</div>
    <p id="result-message"></p>
    <p id="result-email"></p>
    <p>Merci d‚Äôavoir particip√© ! Un r√©capitulatif vous a √©t√© envoy√© par email.</p>
  </div>

  <script>
    // Questions du quiz (√† personnaliser selon votre contexte)
    const questions = [
      {
        q: "Quelle est la meilleure pratique pour un mot de passe ?",
        a: ["Utiliser le m√™me mot de passe partout", "Ajouter des chiffres et symboles al√©atoires", "Utiliser une phrase secr√®te longue et unique", "√âcrire son mot de passe sur un post-it"],
        correct: 2
      },
      {
        q: "Que faire si vous recevez un email suspect avec une pi√®ce jointe ?",
        a: ["L‚Äôouvrir pour v√©rifier", "Le transf√©rer √† un coll√®gue", "Le supprimer sans l‚Äôouvrir", "R√©pondre pour demander qui l‚Äôenvoie"],
        correct: 2
      },
      {
        q: "Qu‚Äôest-ce que le phishing ?",
        a: ["Un virus informatique", "Une technique de p√™che num√©rique", "Une tentative de vol d‚Äôidentifiants par usurpation", "Un logiciel de sauvegarde"],
        correct: 2
      },
      {
        q: "Faut-il mettre √† jour r√©guli√®rement ses logiciels ?",
        a: ["Non, √ßa ralentit l‚Äôordinateur", "Seulement les logiciels payants", "Oui, pour corriger les failles de s√©curit√©", "Uniquement si l‚ÄôIT le demande"],
        correct: 2
      },
      {
        q: "Quand vous quittez votre poste, que devez-vous faire ?",
        a: ["Verrouiller l‚Äô√©cran", "Laisser l‚Äôordinateur allum√©", "D√©brancher le c√¢ble r√©seau", "Rien, c‚Äôest automatique"],
        correct: 0
      },
      {
        q: "Qu‚Äôest-ce qu‚Äôun VPN ?",
        a: ["Un antivirus", "Un r√©seau priv√© virtuel s√©curis√©", "Un type de mot de passe", "Un outil de piratage"],
        correct: 1
      },
      {
        q: "Est-il s√©curis√© d‚Äôutiliser une cl√© USB trouv√©e dans le hall ?",
        a: ["Oui, si elle semble propre", "Non, elle peut contenir un malware", "Oui, apr√®s l‚Äôavoir format√©e", "Seulement si elle est petite"],
        correct: 1
      },
      {
        q: "Quel est le risque principal du Wi-Fi public non s√©curis√© ?",
        a: ["Connexion lente", "Vol de donn√©es en clair", "Perte de batterie", "Publicit√© intrusive"],
        correct: 1
      },
      {
        q: "Que signifie 2FA ?",
        a: ["Deux fichiers autoris√©s", "Authentification √† deux facteurs", "Format de fichier s√©curis√©", "Double v√©rification antivirus"],
        correct: 1
      },
      {
        q: "Qui contacter en cas de suspicion de cyberattaque ?",
        a: ["Personne, ce n‚Äôest pas grave", "Un ami informaticien", "Le service informatique de l‚Äô√©cole", "Google"],
        correct: 2
      }
    ];

    let currentQuestion = 0;
    let score = 0;
    let userEmail = '';

    function startQuiz() {
      const email = document.getElementById('user-email').value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert("Veuillez entrer un email valide.");
        return;
      }
      userEmail = email;
      document.getElementById('email-screen').style.display = 'none';
      document.getElementById('quiz-screen').style.display = 'block';
      loadQuestion();
    }

    function loadQuestion() {
      const q = questions[currentQuestion];
      document.getElementById('question-text').textContent = q.q;
      const answersDiv = document.getElementById('answers');
      answersDiv.innerHTML = '';
      q.a.forEach((answer, index) => {
        const btn = document.createElement('button');
        btn.textContent = answer;
        btn.style.marginTop = '10px';
        btn.style.backgroundColor = '#f8f9fa';
        btn.style.color = '#333';
        btn.onclick = () => selectAnswer(index);
        answersDiv.appendChild(btn);
      });
      document.getElementById('next-btn').style.display = 'none';
      updateProgress();
    }

    function selectAnswer(selected) {
      const q = questions[currentQuestion];
      if (selected === q.correct) {
        score++;
        document.querySelectorAll('#answers button')[selected].style.backgroundColor = '#d4edda';
      } else {
        document.querySelectorAll('#answers button')[selected].style.backgroundColor = '#f8d7da';
        document.querySelectorAll('#answers button')[q.correct].style.backgroundColor = '#d4edda';
      }
      document.querySelectorAll('#answers button').forEach(b => b.disabled = true);
      document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < questions.length) {
        loadQuestion();
      } else {
        showResult();
      }
    }

    function updateProgress() {
      const percent = ((currentQuestion) / questions.length) * 100;
      document.getElementById('progress-bar').style.width = percent + '%';
    }

    function showResult() {
      document.getElementById('quiz-screen').style.display = 'none';
      document.getElementById('result-screen').style.display = 'block';

      let badge = 'ü•â';
      let message = '';
      const percent = (score / questions.length) * 100;

      if (percent >= 90) {
        badge = 'ü•á';
        message = "Excellent ! Vous √™tes un champion de la cybers√©curit√© !";
      } else if (percent >= 70) {
        badge = 'ü•à';
        message = "Tr√®s bon ! Vous ma√Ætrisez les bases essentielles.";
      } else if (percent >= 50) {
        badge = 'ü•â';
        message = "Bon d√©but ! Relisez les bonnes pratiques.";
      } else {
        badge = 'üìö';
        message = "√Ä revoir ! La cybers√©curit√© est cruciale pour tous.";
      }

      document.getElementById('badge').textContent = badge;
      document.getElementById('result-message').textContent = message;
      document.getElementById('result-email').textContent = `R√©sultat envoy√© √† : ${userEmail}`;

      // Envoi des donn√©es au backend
      sendDataToServer({ email: userEmail, score, total: questions.length });
    }

    async function sendDataToServer(data) {
      try {
        const response = await fetch('/api/submit-quiz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!response.ok) console.warn("Erreur lors de l‚Äôenvoi des r√©sultats.");
      } catch (err) {
        console.error("Impossible de contacter le serveur.", err);
      }
    }
  </script>
</body>
</html>
