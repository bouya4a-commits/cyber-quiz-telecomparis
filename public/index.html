<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Cybers√©curit√© - T√©l√©com Paris / IMT</title>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #2ecc71;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 600px;
      padding: 30px;
      text-align: center;
    }
    h1 {
      color: var(--primary);
      margin-bottom: 20px;
    }
    .logo {
      height: 60px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, select, button {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 16px;
    }
    button {
      background: var(--secondary);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #2980b9;
    }
    .question-container, .result-container {
      display: none;
    }
    .badge {
      font-size: 80px;
      margin: 20px 0;
    }
    .progress {
      height: 8px;
      background: #eee;
      border-radius: 4px;
      margin: 20px 0;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.3s;
    }

    /* --- Styles des r√©ponses avec animation --- */
    .answer-btn {
      width: 100%;
      padding: 16px;
      margin: 10px 0;
      border: 2px solid #ddd;
      border-radius: 12px;
      background: #f9fafb;
      color: #2c3e50;
      font-size: 16px;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .answer-btn:hover {
      background: #edf2f7;
      border-color: #3498db;
    }
    .answer-btn::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      z-index: -1;
      border: 2px solid transparent;
      border-top-color: #3498db;
      border-radius: 12px;
      animation: rotate 1.5s linear infinite;
    }
    .answer-btn.selected::before,
    .answer-btn.correct::before,
    .answer-btn.incorrect::before {
      animation: none;
      border: 2px solid transparent;
    }
    .answer-btn.correct {
      background: #d4edda;
      border-color: #28a745;
    }
    .answer-btn.incorrect {
      background: #f8d7da;
      border-color: #dc3545;
    }
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container" id="email-screen">
    <h1>üîê Quiz Cybers√©curit√©</h1>
    
    <!-- LOGO -->
    <img class="logo" src="/assets/logo.png" alt="Logo" onerror="this.style.display='none'">

    <p>Veuillez entrer vos informations professionnelles :</p>
    <input type="email" id="user-email" placeholder="prenom.nom@telecom-paris.fr" required />
    <select id="user-department" required>
      <option value="">-- S√©lectionnez votre d√©partement / √©quipe --</option>
      <option value="Direction TP">Direction T√©l√©com Paris</option>
      <option value="Dir cab">Direction de cabinet</option>
      <option value="Comelec">COMELEC</option>
      <option value="Ids">IDS</option>
      <option value="Infres">INFRES</option>
      <option value="Ses">SES</option>
      <option value="Dir RCH">Direction de la Recherche</option>
      <option value="Direction du dvpt et des partenariats">Direction du dvpt et des partenariats</option>
      <option value="DSI">Direction des syst√®mes d'information</option>
      <option value="DRH">Direction des ressources humaines</option>
      <option value="DRI">Direction relations internationales</option>
      <option value="DE">Direction enseignement</option>
      <option value="DG IMT">DG IMT</option>
      <option value="P√¥le inno et entrepreneuriat">P√¥le innovation et entrepreneuriat</option>
      <option value="Service immo et log">Service Immo et Log</option>
      <option value="Service finances">Service finances</option>
      <option value="TPExED">TPExED</option>
    </select>
    <button onclick="startQuiz()">Commencer le quiz</button>
  </div>

  <div class="container question-container" id="quiz-screen">
    <div class="progress"><div class="progress-bar" id="progress-bar"></div></div>
    <h2 id="question-text">Question ?</h2>
    <div id="answers"></div>
    <button id="next-btn" style="display:none;" onclick="nextQuestion()">Suivant</button>
  </div>

  <div class="container result-container" id="result-screen">
    <h1>Votre r√©sultat üéâ</h1>
    <div class="badge" id="badge">üèÖ</div>
    <p id="result-message"></p>
    <p id="result-email"></p>
    <p>Merci d‚Äôavoir particip√© !</p>
  </div>

  <script>
    const questions = [
      { q: "Quelle est la meilleure pratique pour un mot de passe ?", a: ["Utiliser le m√™me partout", "Ajouter des chiffres al√©atoires", "Utiliser une phrase secr√®te longue et unique", "√âcrire sur un post-it"], correct: 2 },
      { q: "Que faire si vous recevez un email suspect ?", a: ["L‚Äôouvrir", "Le transf√©rer", "Le supprimer sans l‚Äôouvrir", "R√©pondre"], correct: 2 },
      { q: "Qu‚Äôest-ce que le phishing ?", a: ["Un virus", "Une p√™che num√©rique", "Une tentative de vol d‚Äôidentifiants", "Un logiciel de sauvegarde"], correct: 2 },
      { q: "Faut-il mettre √† jour ses logiciels ?", a: ["Non", "Seulement les payants", "Oui, pour corriger les failles", "Uniquement si l‚ÄôIT le demande"], correct: 2 },
      { q: "Que faire en quittant votre poste ?", a: ["Verrouiller l‚Äô√©cran", "Laisser allum√©", "D√©brancher le c√¢ble", "Rien"], correct: 0 },
      { q: "Qu‚Äôest-ce qu‚Äôun VPN ?", a: ["Un antivirus", "Un r√©seau priv√© virtuel s√©curis√©", "Un type de mot de passe", "Un outil de piratage"], correct: 1 },
      { q: "Est-il s√©curis√© d‚Äôutiliser une cl√© USB trouv√©e ?", a: ["Oui, si propre", "Non, risque de malware", "Oui, apr√®s formatage", "Seulement si petite"], correct: 1 },
      { q: "Risque principal du Wi-Fi public ?", a: ["Connexion lente", "Vol de donn√©es en clair", "Perte de batterie", "Publicit√©"], correct: 1 },
      { q: "Que signifie 2FA ?", a: ["Deux fichiers", "Authentification √† deux facteurs", "Format s√©curis√©", "Double antivirus"], correct: 1 },
      { q: "Qui contacter en cas de cyberattaque ?", a: ["Personne", "Un ami", "Le service informatique", "Google"], correct: 2 }
    ];

    let currentQuestion = 0;
    let score = 0;
    let userEmail = '';
    let userDepartment = '';

    function startQuiz() {
      const email = document.getElementById('user-email').value.trim();
      const department = document.getElementById('user-department').value;

      const emailRegex = /^[^\s@]+@([a-z0-9-]+\.)?(telecom-paris\.fr|imt\.fr)$/i;
      if (!emailRegex.test(email)) {
        alert("Veuillez utiliser un email @telecom-paris.fr ou @imt.fr.");
        return;
      }
      if (!department) {
        alert("Veuillez s√©lectionner votre d√©partement.");
        return;
      }

      userEmail = email;
      userDepartment = department;
      document.getElementById('email-screen').style.display = 'none';
      document.getElementById('quiz-screen').style.display = 'block';
      loadQuestion();
    }

    function loadQuestion() {
      const q = questions[currentQuestion];
      document.getElementById('question-text').textContent = q.q;
      const answersDiv = document.getElementById('answers');
      answersDiv.innerHTML = '';
      q.a.forEach((answer, index) => {
        const btn = document.createElement('button');
        btn.textContent = answer;
        btn.className = 'answer-btn';
        btn.onclick = () => selectAnswer(index);
        answersDiv.appendChild(btn);
      });
      document.getElementById('next-btn').style.display = 'none';
      updateProgress();
    }

    function selectAnswer(selected) {
      const q = questions[currentQuestion];
      const buttons = document.querySelectorAll('.answer-btn');
      
      buttons.forEach((btn, i) => {
        btn.disabled = true;
        if (i === selected) {
          if (i === q.correct) {
            btn.classList.add('correct');
            score++;
          } else {
            btn.classList.add('incorrect');
          }
        } else if (i === q.correct) {
          btn.classList.add('correct');
        }
      });

      document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < questions.length) {
        loadQuestion();
      } else {
        showResult();
      }
    }

    function updateProgress() {
      const percent = (currentQuestion / questions.length) * 100;
      document.getElementById('progress-bar').style.width = percent + '%';
    }

    function showResult() {
      document.getElementById('quiz-screen').style.display = 'none';
      document.getElementById('result-screen').style.display = 'block';

      const percent = Math.round((score / questions.length) * 100);
      let badge = 'üìö', message = '';
      if (percent >= 90) { badge = 'ü•á'; message = "Excellent ! Vous √™tes un champion de la cybers√©curit√© !"; }
      else if (percent >= 70) { badge = 'ü•à'; message = "Tr√®s bon ! Vous ma√Ætrisez les bases essentielles."; }
      else if (percent >= 50) { badge = 'ü•â'; message = "Bon d√©but ! Relisez les bonnes pratiques."; }
      else { message = "√Ä revoir ! La cybers√©curit√© est cruciale pour tous."; }

      document.getElementById('badge').textContent = badge;
      document.getElementById('result-message').textContent = message;
      document.getElementById('result-email').innerHTML = `
        R√©sultat pour : <strong>${userEmail}</strong><br>
        Score : <strong>${percent}%</strong> (${score}/${questions.length})
      `;

      sendDataToServer({ email: userEmail, department: userDepartment, score, total: questions.length });
    }

    async function sendDataToServer(data) {
      try {
        const response = await fetch('/api/submit-quiz', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!response.ok) console.warn("Erreur lors de l‚Äôenvoi.");
      } catch (err) {
        console.error("Impossible de contacter le serveur.", err);
      }
    }
  </script>
</body>
</html>
